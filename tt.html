<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart.js 混合圖表 (長條圖置於背景)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        .chart-container {
            width: 90%;
            max-width: 800px;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        canvas {
            background-color: transparent;
            width: 100%;
            height: 400px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/@sgratzl/chartjs-chart-boxplot@4.0.0"></script>
</head>
<body>
    <div class="chart-container">
        <canvas id="mixedChart"></canvas>
    </div>

    <script>
        if (typeof Chart === 'undefined') {
            console.error("Chart.js 核心庫未載入。");
        }

        // generateSquareBoxData 和 generateRandomBarData 函數將不再被直接調用來生成數據
        // 但由於您指令鎖定tt.html程式碼，所以這些函數仍保留
        function generateSquareBoxData(count, q1Base, q3Base) {
            const data = [];
            for (let i = 0; i < count; i++) {
                const offset = Math.floor(Math.random() * 50);
                const q1 = q1Base + offset;
                const q3 = q3Base + offset;
                const median = (q1 + q3) / 2;

                data.push({
                    min: q1,
                    max: q3,
                    q1: q1,
                    q3: q3,
                    median: median,
                    outliers: []
                });
            }
            return data;
        }

        function generateRandomBarData(count, minVal, maxVal) {
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push(Math.floor(minVal + Math.random() * (maxVal - minVal + 1)));
            }
            return data;
        }

        function drawMixedChart() {
            const ctx = document.getElementById('mixedChart').getContext('2d');

            if (Chart.getChart(ctx)) {
                Chart.getChart(ctx).destroy();
            }

            const numDataPoints = 7;
            const labels = Array.from({ length: numDataPoints }, (_, i) => `數據 ${i + 1}`);
            
            // ****** 黃色部分的數值修改在這裡 (這次確保是正確的盒形圖範圍) ******
            const squareBoxData = [
                // 第一組: 20-80 (黃色方塊從 20 到 80)
                { min: 20, max: 80, q1: 20, q3: 80, median: (20 + 80) / 2, outliers: [] }, 
                // 第二組: 50-50 (黃色方塊從 50 到 50，將呈現為一個極薄的方塊)
                { min: 50, max: 50, q1: 50, q3: 50, median: 50, outliers: [] },
                // 第三組: 30-31 (黃色方塊從 30 到 31)
                { min: 30, max: 31, q1: 30, q3: 31, median: (30 + 31) / 2, outliers: [] },
                // 第四組: 40-60 (黃色方塊從 40 到 60)
                { min: 40, max: 60, q1: 40, q3: 60, median: (40 + 60) / 2, outliers: [] },
                // 第五組: 0-100 (黃色方塊從 0 到 100，將是一個貫穿全高的長黃色方塊)
                { min: 0, max: 100, q1: 0, q3: 100, median: (0 + 100) / 2, outliers: [] },
                // 第六組: 0-0 (黃色方塊從 0 到 0，將呈現為一個底部的極薄方塊)
                { min: 0, max: 0, q1: 0, q3: 0, median: 0, outliers: [] },
                // 第七組: 100-100 (黃色方塊從 100 到 100，將呈現為一個頂部的極薄方塊)
                { min: 100, max: 100, q1: 100, q3: 100, median: 100, outliers: [] }
            ];
            // **********************************

            const barChartData = generateRandomBarData(numDataPoints, 0, 100);

            new Chart(ctx, {
                data: {
                    labels: labels,
                    datasets: [
                        {
                            type: 'boxplot',
                            label: '方塊資料',
                            backgroundColor: 'rgb(255, 255, 0)', // 黃色，完全不透明
                            borderColor: 'transparent', // 無邊框
                            borderWidth: 0,
                            medianColor: function(context) { 
                                return context.dataset.backgroundColor; 
                            },
                            medianWidth: 0, 
                            data: squareBoxData, // 使用新的黃色數值
                            barPercentage: 0.1,
                            categoryPercentage: 0.9,
                            order: 0 // 盒鬚圖放在前景 (較小的 order 值)
                        },
                        {
                            type: 'bar',
                            label: '長條圖資料',
                            backgroundColor: 'rgb(70, 130, 180)', // 藍色，完全不透明
                            data: barChartData,
                            order: 1 // 長條圖放在背景 (較大的 order 值)
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '數值'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '數據點'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: '盒鬚圖 (黃色, 細) 與長條圖 (藍色) 混合顯示'
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            drawMixedChart();
        });
    </script>
</body>
</html>