<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新北市新店區氣象資料</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #weather-data { border: 1px solid #ccc; padding: 15px; margin-top: 20px; }
        .station-info { margin-bottom: 10px; padding: 8px; border-bottom: 1px dashed #eee; }
        .station-info:last-child { border-bottom: none; }
        b { color: #333; }
    </style>
</head>
<body>
    <h1>新北市新店區即時氣象觀測</h1>
    <button onclick="getWeatherData()">點我取得氣象資料</button>
    <div id="weather-data">
        <p>點擊按鈕載入資料...</p>
    </div>

    <script>
        // *** 請替換成你自己的 API Key！ ***
        const CWA_API_KEY = 'CWB-A0E4FCC7-9BF5-4ABB-A778-3DB913641D8D'; 

        async function getWeatherData() {
            const dataContainer = document.getElementById('weather-data');
            dataContainer.innerHTML = '<p>載入中...</p>';

            // 氣象局自動氣象站觀測資料的 API 網址
            // 我們想找新北市新店區的資料，所以加入 StationName=新店
            const apiUrl = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/O-A0001-001?Authorization=${CWA_API_KEY}&limit=100&offset=0&format=JSON&StationName=%E6%96%B0%E5%BA%97`; 
            // 注意：%E6%96%B0%E5%BA%97 是「新店」的 URL 編碼，fetch 會自動處理，但直接貼上網址可能需要注意

            try {
                const response = await fetch(apiUrl); // 發送請求
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json(); // 將回應轉換為 JSON 格式

                console.log('取得的氣象資料:', data); // 在控制台查看原始資料結構

                // 檢查資料是否成功取得
                if (data && data.success === 'true' && data.records && data.records.Station) {
                    const stations = data.records.Station;
                    
                    if (stations.length > 0) {
                        let htmlContent = '<h2>新店區相關觀測站資料：</h2>';
                        stations.forEach(station => {
                            const stationName = station.StationName;
                            const obsTime = station.ObsTime.DateTime;
                            const temp = station.WeatherElement.AirTemperature; // 溫度
                            const hum = station.WeatherElement.RelativeHumidity; // 相對濕度
                            const windSpeed = station.WeatherElement.WindSpeed; // 風速
                            const windDir = station.WeatherElement.WindDirection; // 風向代碼

                            // 將風向代碼轉換成文字描述 (這個可能需要查氣象局文件或自行定義)
                            // 這裡只是一個簡化範例
                            let windDirectionText = '未知';
                            if (windDir === 0) windDirectionText = '北';
                            else if (windDir > 0 && windDir < 90) windDirectionText = '東北';
                            else if (windDir === 90) windDirectionText = '東';
                            // ... 依此類推，補齊所有方向

                            htmlContent += `
                                <div class="station-info">
                                    <h3>${stationName}</h3>
                                    <p><b>觀測時間：</b>${obsTime}</p>
                                    <p><b>溫度：</b>${temp}°C</p>
                                    <p><b>相對濕度：</b>${(hum * 100).toFixed(1)}%</p>
                                    <p><b>風速：</b>${windSpeed} m/s</p>
                                    <p><b>風向：</b>${windDirectionText} (${windDir}°)</p>
                                </div>
                            `;
                        });
                        dataContainer.innerHTML = htmlContent;
                    } else {
                        dataContainer.innerHTML = '<p>沒有找到新店區的氣象觀測資料。</p>';
                    }
                } else {
                    dataContainer.innerHTML = '<p>取得資料失敗或資料格式不正確。</p>';
                }

            } catch (error) {
                console.error('Error fetching weather data:', error);
                dataContainer.innerHTML = `<p>載入資料時發生錯誤：${error.message}</p>`;
            }
        }
    </script>
</body>
</html>

