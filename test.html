<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>圓形點移動進度 (10% - 100%) - 含傾斜</title>
    <style>
        body {
            margin: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            background-color: #000;
            color: #eee;
            font-family: sans-serif;
            font-size: 14px;
            padding: 20px 0;
        }
        .figure-wrapper {
            margin-bottom: 40px;
            background-color: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        h3 {
            color: #fff;
            margin-top: 0;
            margin-bottom: 15px;
        }
        canvas {
            background-color: #222;
            border: 2px solid #555;
            display: block;
            margin: 0 auto;
        }
        #version-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="version-info">版本: v2025.07.05.12</div>

    <div class="figures-container">
        </div>

    <script>
        // --- 設定版本號 ---
        const VERSION = 'v2025.07.05.12';
        document.getElementById('version-info').innerText = `版本: ${VERSION}`;

        const commonCanvasWidth = 400;
        const commonCanvasHeight = 400;
        const centerX = commonCanvasWidth / 2;
        const centerY = commonCanvasHeight / 2;
        const radius = 150;
        const dotSize = 2;
        const numDots = 180;
        const tiltAngleDegrees = 23.4; // 月亮的傾斜角度
        const tiltAngleRadians = tiltAngleDegrees * Math.PI / 180; // 轉換為弧度

        // 旋轉點的輔助函數
        function rotatePoint(px, py, cx, cy, angle) {
            const tempX = px - cx;
            const tempY = py - cy;

            const rotatedX = tempX * Math.cos(angle) - tempY * Math.sin(angle);
            const rotatedY = tempX * Math.sin(angle) + tempY * Math.cos(angle);

            return {
                x: rotatedX + cx,
                y: rotatedY + cy
            };
        }

        // 繪製單一畫布的函數
        function drawFigure(canvasId, percentage) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');

            // 清空畫布為背景色
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, commonCanvasWidth, commonCanvasHeight);

            // 繪製圓心 (白色，顯示在最上層) - 圓心是旋轉的原點，所以它不動
            ctx.beginPath();
            ctx.arc(centerX, centerY, 3, 0, Math.PI * 2);
            ctx.fillStyle = '#fff';
            ctx.fill();

            // 繪製原始的藍色左半圓周上的點 (基礎點，現在也會傾斜)
            for (let i = 0; i <= numDots; i++) {
                const angleDegrees = 90 + i;
                const angleRadians = angleDegrees * Math.PI / 180;

                const x = centerX + radius * Math.cos(angleRadians);
                const y = centerY + radius * Math.sin(angleRadians);

                // 應用傾斜旋轉
                const rotatedBluePoint = rotatePoint(x, y, centerX, centerY, tiltAngleRadians);

                ctx.fillStyle = '#00aaff'; // 藍色
                ctx.fillRect(rotatedBluePoint.x - dotSize / 2, rotatedBluePoint.y - dotSize / 2, dotSize, dotSize);
            }

            // 繪製變換後的紅色點 (現在也會傾斜)
            for (let i = 0; i <= numDots; i++) {
                const angleDegrees = 90 + i;
                const angleRadians = angleDegrees * Math.PI / 180;

                const originalX = centerX + radius * Math.cos(angleRadians);
                const originalY = centerY + radius * Math.sin(angleRadians);

                // 計算原始點到中心線的距離 D0
                const D0 = centerX - originalX; // 因為是左半圓，originalX <= centerX

                // 計算移動的距離 (根據百分比 N%)
                const moveDistance = (percentage / 100) * (2 * D0);

                // 新點的 X 座標 (水平位移後)
                const newXBeforeTilt = originalX + moveDistance;
                const newYBeforeTilt = originalY; // Y 座標不變

                // 應用傾斜旋轉
                const rotatedRedPoint = rotatePoint(newXBeforeTilt, newYBeforeTilt, centerX, centerY, tiltAngleRadians);

                ctx.fillStyle = '#ff0000'; // 紅色
                ctx.fillRect(rotatedRedPoint.x - dotSize / 2, rotatedRedPoint.y - dotSize / 2, dotSize, dotSize);
            }
        }

        // 動態生成和繪製所有畫布
        const figuresContainer = document.querySelector('.figures-container');
        for (let p = 10; p <= 100; p += 10) {
            const wrapper = document.createElement('div');
            wrapper.className = 'figure-wrapper';

            const title = document.createElement('h3');
            title.textContent = `走到 ${p}% 的傾斜月相`;
            wrapper.appendChild(title);

            const canvas = document.createElement('canvas');
            canvas.id = `canvas${p}`;
            canvas.width = commonCanvasWidth;
            canvas.height = commonCanvasHeight;
            wrapper.appendChild(canvas);

            figuresContainer.appendChild(wrapper);

            // 繪製內容
            drawFigure(canvas.id, p);
        }
    </script>
</body>
</html>