<!-- 
 file:///D:/mw251.html?key=CWB-A0E4FCC7-9BF5-4ABB-A778-3DB913641D8D;&station1=466881;&rep3=069;&rep7=071;&town1=新店區;
 https://raeltw.github.io/wea.tw/mw251.html?key=CWA-422C592A-18E7-4C2E-BBD2-003CCC1F18D4;&station1=466881;&rep3=069;&rep7=071;&town1=新店區;
Netlify rael.tw ss_aa_60412
 -->

<!DOCTYPE html>
<html lang='zh-Hant'>
<head>

    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>天氣預報 '25 </title> <!-- 我挑戰成功了!! -->

<style>

body 
{
    padding: 4px;
    background-color: #000;
    color: #aaa;
    /* color: #ff0; */
}

.undeline
{
   border-bottom: 1px solid #444; 
   margin-bottom: 8px;
}

.chart-container {
   height: 408px !important;
   width: 960px;
}

</style>

</head>

<body>

    
<div id='api_data1'>現在天氣: v 1.2.1<br /></div>
<div class="chart-container">
<div id='api_data3'>3日預報:<br /></div>
    <canvas id="Chart3"></canvas>
</div><br /><br /><br /><br />
<div id='api_data7'>1周預報:<br /></div>
<div class="chart-container">
    <canvas id="Chart7"></canvas>
</div><br /><br /><br /><br />



<!-- 這些是工作區 或許等開發完 可以藏起來 -->
<div id='testarea' class='undeline'>TEST<br /></div>
<div id='nowarea' class='undeline'>NOW<br /></div>
<div id='3darea' class='undeline'>3 Days<br /></div>
<div id='1warea' class='undeline'>1 Week<br /></div>


<!-- 繪圖工具 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1"></script>
<script src="https://cdn.jsdelivr.net/npm/@sgratzl/chartjs-chart-boxplot@4.0.0"></script>



<script>
// 共用函數


//C
function dtcalct(_dt0, _n1) {
    // 1. 解析輸入字串 '年-月-日-時' 為 Date 物件
    // 將 "2025-06-25-15" 轉換為 Date 物件可解析的格式，例如 "2025-06-25T15:00:00"
    const parts = _dt0.split('-'); // 分割成 ['2025', '06', '25', '15']

    if (parts.length !== 4) {
        console.error("dtcalct 錯誤：日期時間字串格式不正確，應為 'YYYY-MM-DD-HH'");
        return null; // 返回 null 或拋出錯誤，表示無效輸入
    }

    const year = parseInt(parts[0], 10);
    const month = parseInt(parts[1], 10) - 1; // 月份在 JavaScript Date 物件中是 0-11
    const day = parseInt(parts[2], 10);
    const hour = parseInt(parts[3], 10);

    // 建立一個 Date 物件。注意：如果沒有指定分鐘和秒，它們會預設為 0
    // 使用 UTC 時間可以避免時區問題，確保加減結果的準確性
    const dateObj = new Date(Date.UTC(year, month, day, hour, 0, 0));

    // 2. 對小時進行加減運算
    dateObj.setUTCHours(dateObj.getUTCHours() + _n1);

    // 3. 將結果格式化回 '年-月-日-時' 字串

    // 獲取新的日期時間組件
    const newYear = dateObj.getUTCFullYear();
    // getUTCMonth() 返回 0-11，所以需要 +1
    const newMonth = (dateObj.getUTCMonth() + 1).toString().padStart(2, '0');
    const newDay = dateObj.getUTCDate().toString().padStart(2, '0');
    const newHour = dateObj.getUTCHours().toString().padStart(2, '0');

    // 拼接成目標格式
    return `${newYear}-${newMonth}-${newDay}-${newHour}`;
}

/**
 * 根據給定的下限和上限數值，生成 Chart.js boxplot 數據格式的物件。
 * 這個物件會使 boxplot 呈現為一個從 min 到 max 的實心方塊。
 *
 * @param {number} lowerBound - 方塊的下限 (對應 min 和 q1)。
 * @param {number} upperBound - 方塊的上限 (對應 max 和 q3)。
 * @returns {object} 符合 Chart.js boxplot 數據格式的單一數據物件。
 */
function createBoxplotData(lowerBound, upperBound) {
    // 確保 lowerBound 不大於 upperBound
    const minVal = Math.min(lowerBound, upperBound);
    const maxVal = Math.max(lowerBound, upperBound);

    return {
        min: minVal,
        max: maxVal,
        q1: minVal,      // Q1 等於最小值，確保方塊從這裡開始
        q3: maxVal,      // Q3 等於最大值，確保方塊到這裡結束
        median: (minVal + maxVal) / 2, // 中位數在 min 和 max 的中間
        outliers: []     // 盒鬚圖通常沒有離群值（如果沒有額外定義）
    };
}


//M
function makeA(_str, _url) 
{ // 產生 a 連結 <a href="https://example.com" target="_blank">Website</a>
  
    _tmp1='<a href="'+_url+'" target="_blank">'+_str+'</a>';
    //window.alert(_tmp1);

    //這寫法比較長 但很容易懂 但傳回去的格式是不同的接收方式
    //let _tmp1 = document.createElement('a');
    //_tmp1.href = _url;
    //_tmp1.textContent = _str;
    //_tmp1.target = '_blank';
    //window.alert(_tmp1);

    return _tmp1;

}


//R
function removeTrailingSemicolon(str) 
{  // 檢查字串是否為空或非字串類型
  if (typeof str !== 'string' || str.length === 0) {
    return str;
  }

  // 使用 replace() 方法和正則表達式
  // /;+$/: 
  //   ;   - 匹配一個分號
  //   +   - 匹配一個或多個（連續的）分號
  //   $   - 匹配字串的結尾
  //   ''  - 替換成空字串 (即刪除匹配到的內容)
  return str.replace(/;+$/, '');
}


//S
function sendmsg(block1, msg1, br1= 1) 
 {  // 傳送訊息到某個區塊
 
   //是否換行 只能0 或1 預設是 1
   br1 = (br1 === 1) ? 1 : 0;
   
   const outputElement = document.getElementById(block1);
   if (outputElement) {
      // *** 重要的安全性考量：將訊息內容作為純文字追加 ***
      // 使用 textContent 可以防止 msg 中的 HTML 標籤被解析，有效避免 XSS 攻擊。
      outputElement.innerHTML += msg1; 

      if (br1=== 1) {
         outputElement.innerHTML += '<br />';
      }
   }
}


/// ---

//測試區
       //sendmsg('testarea', '大家好');
       //sendmsg('testarea', '我是王先生');

</script>


 <!--  呼叫 現在觀測 -->
<script src="now1.js"></script>
<script> document.addEventListener('DOMContentLoaded', () => { nowwea1(); } ); </script>

<!-- 3日預報 -->
<script>
   //變數陣列在此宣告 才能讓變數傳遞到所有子程序去
   var currentDataIndex = -1; 
   var _hi0=[]; _dt0=[]; _dt1=[]; _temp0=[]; _temp1=[]; _dew0=[]; _humi0=[]; _prec0=[]; _descl=[]; _weat3=[]; _comf0=[];
   // 日期0(原始), 日期1(精簡), 溫度, 體感溫度, 露點溫度, 相對濕度, 降雨機率
</script>
 <!--  3日預報 -->
<! -- 帶入順序 要從最底層的開始寫 -->
<script src="3d1chart.js"></script>
<script src="3d1.js"></script>
<script> document.addEventListener('DOMContentLoaded', () => { d31(); } ); </script>

<!-- 1周預報 -->
<script>
   //變數陣列在此宣告 才能讓變數傳遞到所有子程序去
   var currentDataIndex = -1; 
   var _hi0=[]; _dt0=[]; _dt1=[]; _temph=[]; _templ=[]; _tempa=[]; _dew0=[]; _humi0=[]; _prec0=[]; _descl=[]; _weat1=[]; _comf0=[]; _plot0=[];
   // _weat- 有bug 多加一個陣列試試 > 測試 會錯就是會錯 換陣列還是錯 網頁多refresh幾次就會出現了 '250623
   // 日期0(原始), 日期1(精簡), 高溫, 低溫, 均溫, 露點溫度, 相對濕度, 降雨機率
</script>
<! -- 帶入順序 要從最底層的開始寫 -->
<script src="1w1chart.js"></script>
<script src="1w1.js"></script>

<script> document.addEventListener('DOMContentLoaded', () => { w11(); } ); </script>


</body>

</html>